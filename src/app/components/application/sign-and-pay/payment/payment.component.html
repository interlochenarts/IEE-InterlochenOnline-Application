<header>
  <div class="row">
    <div class="col-12">
      <h3>Make a Payment</h3>
    </div>
  </div>
</header>

<div *ngIf="userType === 'parent'">
  <div *ngIf="isLoading">
    <i class="fa fa-spinner fa-pulse fa-fw fa-2x"></i> Loading...
  </div>
  <div *ngIf="!isLoading">
    <div class="default" *ngIf="paymentReceived">
      You have paid your registration fee of {{appData.payment.amountPaid | currency:'USD'}}.
    </div>
    <div *ngIf="!paymentReceived && appData.payment.amountOwed === 0.00 && appData.payment.appliedCredits <= 0">
      You must choose a program before you can pay.
    </div>
    <div *ngIf="!paymentReceived && appData.payment.spendableCredit > 0" class="mb-4">
      <label>Would you like to apply your Interlochen Arts Camp credit of
        {{(appData.payment.spendableCredit | currency:'USD')}} towards your registration fee?</label>
      <div class="default">
        <div class="form-check form-check-inline">
          <input type="radio"
                 class="form-check-input"
                 [(ngModel)]="appData.payment.useCredit"
                 [disabled]="appData.payment.tuitionPaid"
                 name="useCredit_Yes"
                 id="useCredit_Yes"
                 [value]="true"/>
          <label for="useCredit_Yes" class="form-check-label">Yes</label>
        </div>
        <div class="form-check form-check-inline">
          <input type="radio"
                 class="form-check-input"
                 [(ngModel)]="appData.payment.useCredit"
                 [disabled]="appData.payment.tuitionPaid"
                 name="useCredit_No"
                 id="useCredit_No"
                 [value]="false"/>
          <label for="useCredit_No" class="form-check-label">No</label>
        </div>
      </div>
    </div>

    <div *ngIf="!paymentReceived">
      <p class="mb-0">Total tuition: {{totalTuition | currency:'USD'}}</p>
      <p class="mb-0" *ngIf="this.appData.payment.appliedWaivers > 0">Discount Amount: -{{appData.payment.appliedWaivers | currency:'USD'}}</p>
      <p class="mb-0" *ngIf="this.appData.payment.appliedCredits > 0">Credit Amount: -{{appData.payment.appliedCredits | currency:'USD'}}</p>
      <p class="mb-0" *ngIf="this.appData.payment.spendableCredit > 0 && appData.payment.useCredit">Credit Amount: -{{appData.payment.spendableCredit | currency:'USD'}}</p>
      <strong><p>Amount owed: {{achAmount | currency:'USD'}}</p></strong>
    </div>
    <div *ngIf="!paymentReceived && !codeDisabled" class="mb-4">
      <label for="have-code">I have a discount code</label>
      <input class="ml-1" name="have-code" id="have-code" type="checkbox" [checked]="hasCode" (change)="hasCode = !hasCode">
      <div *ngIf="hasCode">
        <label for="code">Discount Code</label>
        <div class="default">
          <input type="text"
                 [(ngModel)]="enteredCode"
                 name="code"
                 id="code"
                 maxlength="50"
                 pattern="^[^\s@]+@[^\s@]+\.[^\s@]{2,}$"/>
          <button (click)="applyCode()"
                  class="btn btn-default ml-2">
            Apply
          </button>
        </div>
      </div>
      <div *ngIf="appData.payment.waiverDescription" class="mt-2">
        <i class="fa fa-warning" style="color:red"></i><span class="reviewError">{{appData.payment.waiverDescription}}</span>
      </div>
    </div>
    <div *ngIf="codeDisabled && !appData.payment.tuitionPaid" class="mb-4">
      <p class="mb-1">Code Applied: {{appData.payment.waiverCode}}</p>
<!--      <p>Discount Amount: {{appData.payment.appliedWaivers | currency:'USD'}}</p>-->
    </div>

    <button *ngIf="feeCoveredByCredit && !paymentReceived && appData.payment.spendableCredit > 0" class="btn btn-primary mt-4" (click)="confirmCredit()">Confirm</button>
    <iee-ach *ngIf="canPay()" [useCredit]="appData.payment.useCredit"></iee-ach>
  </div>
</div>

<div *ngIf="userType === 'student'">
  <p>This page may only be accessed by a parent(s) or guardian(s). Parent(s) or guardian(s) must log in with
    their unique credentials in order to complete this section and are advised not to share their username and password
    with the student applicant.
  </p>

  <p>Click here to send your parent or guardian their unique parent or guardian credentials.</p>
  <div *ngFor="let parent of appData.parents" class="my-4">
    <button class="btn btn-primary"
            (click)="sendParentCredentials(parent)">
      Send login information to {{parent.firstName}} {{parent.lastName}}</button>
  </div>
  <div class="alert alert-info my-4" *ngIf="credentialStatus">
    {{credentialStatus}}
  </div>
</div>
